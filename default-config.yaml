# ═══════════════════════════════════════════════════════════════════════════════
# PENSION FORECAST CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
#
# This simulator helps optimize pension drawdown strategies for tax efficiency.
# It compares 8 different strategy combinations and identifies the best approach.
#
# ═══════════════════════════════════════════════════════════════════════════════
# TWO OPERATING MODES
# ═══════════════════════════════════════════════════════════════════════════════
#
# 1. FIXED INCOME MODE (default)
#    ────────────────────────────
#    You specify: How much monthly income you need (with multiple age-based tiers)
#    Simulator shows: How long your funds will last, total tax paid
#    Best for: "Can I afford £5,000/month until 67, then £3,000/month?"
#
#    Key settings:
#      income_requirements.tiers: Multiple income phases by age range
#        - Fixed amounts: monthly_amount: 5000 (£/month)
#        - Percentages: monthly_amount: 5, is_percentage: true (5% annual rate)
#
#    Run with: ./goPensionForecast or ./goPensionForecast -html
#
# 2. DEPLETION MODE (-depletion flag)
#    ─────────────────────────────────
#    You specify: Target age to deplete funds by
#    Simulator shows: Maximum sustainable income that depletes funds at target age
#    Best for: "How much can I spend if I want funds to last until age 80?"
#
#    Key settings:
#      income_requirements.target_depletion_age: Age when funds should reach zero
#      income_requirements.tiers: Multiple ratio-based phases by age range
#        - Each tier has a 'ratio' that controls relative income in that phase
#        - A tier with ratio: 5 gets 5× the base multiplier
#        - The simulator finds the multiplier that depletes funds at target age
#
#    Example with ratios 5, 3, 2 across three tiers:
#    - Phase 1: multiplier × 5 (highest spending early)
#    - Phase 2: multiplier × 3 (medium spending)
#    - Phase 3: multiplier × 2 (lowest spending late)
#
#    Run with: ./goPensionForecast -depletion or ./goPensionForecast -depletion -html
#
# ═══════════════════════════════════════════════════════════════════════════════
# SENSITIVITY ANALYSIS (-sensitivity flag)
# ═══════════════════════════════════════════════════════════════════════════════
#
# Runs simulations across a range of growth rates to show how results change
# under different market conditions. Creates a matrix showing:
# - Fixed mode: Which strategy is best at each growth rate combination
# - Depletion mode: Maximum sustainable income at each growth rate combination
#
# Key settings (in sensitivity section):
#   pension_growth_min/max: Range of pension growth rates to test
#   savings_growth_min/max: Range of ISA growth rates to test
#   step_size: Increment between test points (e.g., 0.01 = 1%)
#
# Run with: ./goPensionForecast -sensitivity or ./goPensionForecast -depletion -sensitivity
#
# ═══════════════════════════════════════════════════════════════════════════════
# STRATEGIES COMPARED
# ═══════════════════════════════════════════════════════════════════════════════
#
# The simulator compares 8 combinations (4 strategies × 2 mortgage options):
#
# Drawdown Strategies:
#   ISAFirst: Withdraw from ISA/savings first, then pension
#   PenFirst: Withdraw from pension first, then ISA
#   TaxOpt: Dynamically choose source to minimize tax
#   Combined: Take pension and deposit excess to ISA (fills ISA allowances)
#
# Mortgage Options:
#   Early Payoff: Pay off mortgage as early as possible
#   Normal Payoff: Keep mortgage until natural end date
#
# ═══════════════════════════════════════════════════════════════════════════════
# CONFIGURATION SECTIONS
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# PEOPLE - Define household members
# ─────────────────────────────────────────────────────────────────────────────
people:
  - name: "Person1"
    birth_date: "1970-12-15"       # YYYY-MM-DD format
    retirement_date: "2026-07-15"  # Date when you stop working (YYYY-MM-DD) - determines which tax year
    pension_access_age: 55         # Age when DC pension can be accessed (UK minimum: 55, rising to 57)
    state_pension_age: 67          # Age when state pension starts
    tax_free_savings: 100000.00    # ISA/savings balance (£)
    pension: 500000.00             # Pension pot value (£)
    isa_annual_limit: 20000.00     # Max annual ISA contribution (£)
    work_income_net: 0             # Monthly take-home pay after tax and NI (£)
    # Note: If retirement_date is in July 2026, income requirements start in tax year 2026/27
    # If you retire in February 2026, that's tax year 2025/26

  - name: "Person2"
    birth_date: "1975-01-13"
    retirement_date: "2032-06-01"  # Date when you stop working
    pension_access_age: 57         # Age when DC pension can be accessed
    state_pension_age: 67
    tax_free_savings: 100000.00
    pension: 500000.00
    isa_annual_limit: 20000.00     # Max annual ISA contribution (£)
    work_income_net: 0             # Monthly take-home pay after tax and NI (£)
    # Optional: Defined Benefit pension (e.g., Teachers, NHS, Civil Service)
    db_pension_amount: 400.00     # Annual DB pension amount (£)
    db_pension_start_age: 57       # Age when DB pension starts
    db_pension_name: "Government Pension"

# ─────────────────────────────────────────────────────────────────────────────
# FINANCIAL - Growth rates and fixed income sources
# ─────────────────────────────────────────────────────────────────────────────
financial:
  pension_growth_rate: 5%          # Annual pension pot growth (after fees)
  savings_growth_rate: 5%          # Annual ISA/savings growth
  income_inflation_rate: 3%        # Annual increase in income needs
  state_pension_amount: 12547.60   # Current full state pension (£/year/person)
  state_pension_inflation: 3%      # Annual state pension increase
  tax_band_inflation: 3%           # Tax band adjustment (0% = frozen bands)

  # ═══ GRADUAL GROWTH DECLINE ═══
  # Models the "age in bonds" strategy - shifting from equities to bonds over time
  # Growth rates linearly decline from start rate to end rate by target age
  growth_decline_enabled: false    # Enable gradual growth rate decline
  pension_growth_end_rate: 4%      # Pension growth rate at target age
  savings_growth_end_rate: 4%      # ISA growth rate at target age
  growth_decline_target_age: 80    # Age when growth reaches end rate
  growth_decline_reference_person: "Person1"  # Whose age determines the decline

  # ═══ DEPLETION MODE GROWTH DECLINE ═══
  # Simpler alternative for depletion mode: decline by X% from start to target depletion age
  # Example: 3% decline with 7% start rate = growth declines from 7% to 4% by depletion age
  depletion_growth_decline_enabled: false  # Enable growth decline for depletion mode
  depletion_growth_decline_percent: 3%     # Percentage to decline (e.g., 3% = 0.03)

# ─────────────────────────────────────────────────────────────────────────────
# INCOME REQUIREMENTS - What you need to withdraw
# ─────────────────────────────────────────────────────────────────────────────
# TIERED INCOME: Define multiple income phases based on age ranges.
# Each tier can specify either:
#   - Fixed monthly amount (£): monthly_amount: 5000
#   - Percentage of initial portfolio: monthly_amount: 6, is_percentage: true
#     (6% means 6% annual withdrawal rate = £60k/year on £1M = £5k/month)
#
# Age ranges use start_age and end_age. Omit for open-ended:
#   - end_age: 64          → from retirement until age 64
#   - start_age: 64, end_age: 70  → from age 64 to 70
#   - start_age: 70        → from age 70 onwards
#
income_requirements:
  # ═══ TIERED INCOME (recommended) ═══
  # Example 1: Fixed amounts with multiple tiers
  tiers:
    - end_age: 67
      monthly_amount: 4000.00      # £4,000/month until age 67
    - start_age: 67
      end_age: 75
      monthly_amount: 3000.00      # £3,000/month from 67-75
    - start_age: 75
      monthly_amount: 2500.00      # £2,500/month from 75 onwards

  # Example 2: Percentage-based withdrawal rates (uncomment to use)
  # tiers:
  #   - end_age: 65
  #     monthly_amount: 5           # 5% annual withdrawal rate
  #     is_percentage: true
  #   - start_age: 65
  #     end_age: 75
  #     monthly_amount: 4.5         # 4.5% annual rate
  #     is_percentage: true
  #   - start_age: 75
  #     monthly_amount: 4           # 4% annual rate from 75+
  #     is_percentage: true

  # ═══ DEPLETION MODE SETTINGS ═══
  target_depletion_age: 80         # Age to deplete funds by (use with -depletion)
  # For depletion mode, tiers use 'ratio' instead of 'monthly_amount':
  # tiers:
  #   - end_age: 65
  #     ratio: 5.0                  # Higher spending ratio before 65
  #   - start_age: 65
  #     end_age: 75
  #     ratio: 3.0                  # Medium spending 65-75
  #   - start_age: 75
  #     ratio: 2.0                  # Lower spending from 75+

  # ═══ LEGACY SETTINGS (used if tiers is empty) ═══
  # monthly_before_age: 4000.00    # Monthly income before age threshold (£)
  # monthly_after_age: 2500.00     # Monthly income at/after age threshold (£)
  # income_ratio_phase1: 5.0       # Depletion mode ratio before threshold
  # income_ratio_phase2: 3.0       # Depletion mode ratio after threshold
  # age_threshold: 67              # Age when income requirement changes

  reference_person: "Person1"      # Whose age determines the tier transitions

# ─────────────────────────────────────────────────────────────────────────────
# MORTGAGE - Outstanding mortgage details
# ─────────────────────────────────────────────────────────────────────────────
mortgage:
  end_year: 2031                   # Year all mortgages naturally end
  early_payoff_year: 2028          # Earliest year for early payoff (lock-in period)
  parts:
    - name: "Repayment"
      principal: 20000.00          # Outstanding balance (£)
      interest_rate: 3.89%         # Annual interest rate
      is_repayment: true           # true = repayment, false = interest-only
      term_years: 6                # Years remaining
      start_year: 2025             # Year mortgage started/renewed
    - name: "Interest Only"
      principal: 200000.00
      interest_rate: 4.14%
      is_repayment: false          # Interest-only: principal due at end
      term_years: 0                # N/A for interest-only
      start_year: 2025

# ─────────────────────────────────────────────────────────────────────────────
# SIMULATION - Time period settings
# ─────────────────────────────────────────────────────────────────────────────
simulation:
  start_year: 2026                 # Year to start simulation
  end_age: 90                      # Age to end simulation (reference person)
  reference_person: "Person1"      # Whose age to use for end calculation

# ─────────────────────────────────────────────────────────────────────────────
# SENSITIVITY - Settings for sensitivity analysis (-sensitivity flag)
# ─────────────────────────────────────────────────────────────────────────────
sensitivity:
  pension_growth_min: 4%           # Minimum pension growth rate to test
  pension_growth_max: 12%          # Maximum pension growth rate to test
  savings_growth_min: 4%           # Minimum ISA growth rate to test
  savings_growth_max: 12%          # Maximum ISA growth rate to test
  step_size: 0.01                  # Step between rates (0.01 = 1%)

# ─────────────────────────────────────────────────────────────────────────────
# TAX BANDS - UK income tax bands (update if rates change)
# ─────────────────────────────────────────────────────────────────────────────
# Note: Tax bands are subject to annual changes by HMRC.
# Current values are for 2024/25 tax year.
tax_bands:
  - name: "Personal Allowance"
    lower: 0
    upper: 12570
    rate: 0.00
  - name: "Basic Rate"
    lower: 12570
    upper: 50270
    rate: 0.20
  - name: "Higher Rate"
    lower: 50270
    upper: 125140
    rate: 0.40
  - name: "Additional Rate"
    lower: 125140
    upper: 10000000
    rate: 0.45

# ─────────────────────────────────────────────────────────────────────────────
# TAX - Personal Allowance tapering settings (update if rules change)
# ─────────────────────────────────────────────────────────────────────────────
# For income over the tapering threshold, the Personal Allowance is reduced
# by the tapering rate (£1 lost per £X over threshold).
#
# Example with 2024/25 values:
#   - At £100,000: Full PA of £12,570
#   - At £110,000: PA reduced by (£110,000 - £100,000) × 0.5 = £5,000 → PA = £7,570
#   - At £125,140: PA reduced by (£125,140 - £100,000) × 0.5 = £12,570 → PA = £0
#
# This creates an effective 60% marginal tax rate in the £100k-£125k band
# (40% income tax + 20% effective from losing PA)
tax:
  personal_allowance: 12570       # Standard Personal Allowance (£)
  tapering_threshold: 100000      # Income above which PA starts to reduce (£)
  tapering_rate: 0.5              # PA reduction per £1 over threshold (£1 lost per £2 = 0.5)
